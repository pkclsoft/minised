set errors 0
unset exit

for testsed in {parameters}
  echo -N "Running {testsed}"
  
  /host/minised/sed -f {testsed}.sed {testsed}.in > {testsed}.tmp >& tmp/{testsed}.err
  set errcode {Status}
* echo -N "sed status: {errcode}.."
  
  exists {testsed}.out
  set existStatus {Status}
  
* echo -N "exists status: {existStatus}.."

  if {existStatus} == 0 
    if {errcode} == 0
      echo " Passed (unexpected)"
    else
      echo " Failed (as expected)"
    end
  else
    echo -N "..checking.."
    
    cmp -S {testsed}.tmp {testsed}.out
    set equalStatus {Status}
    
*   echo -N "results equal: {equalStatus}..."
    
    if {equalStatus} == 0
      echo " Passed"
      
      rm tmp/{testsed}.err
    else
      tcmp {testsed}.tmp {testsed}.out > tmp/{testsed}.diff
      copy -C -P {testsed}.tmp tmp/{testsed}.out
      copy -C -P {testsed}.out out

      echo " Failed !!!"
    end
  end
  
  delete {testsed}.tmp
end
